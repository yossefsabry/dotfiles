#!/bin/bash

# ---------------------------
# Get URL: argument OR clipboard
# ---------------------------

get_clipboard() {
    if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
        command -v wl-paste >/dev/null 2>&1 || {
            echo "wl-paste not found (Wayland)"
            exit 1
        }
        wl-paste
    else
        command -v xclip >/dev/null 2>&1 || {
            echo "xclip not found (X11)"
            exit 1
        }
        xclip -o -selection clipboard
    fi
}

if [ -n "$1" ]; then
    URL="$1"
else
    URL="$(get_clipboard)"
fi

# ---------------------------
# Validate URL
# ---------------------------

if [ -z "$URL" ]; then
    echo "Error: No URL provided and clipboard is empty."
    exit 1
fi

# ---------------------------
# Check if YouTube URL
# ---------------------------

if [[ ! "$URL" =~ (youtube\.com|youtu\.be) ]]; then
    echo "Error: Clipboard URL is not a YouTube link."
    echo "URL: $URL"
    exit 1
fi

# ---------------------------
# Run mpv
# ---------------------------

echo "Opening YouTube video in 480p:"
echo "$URL"

# mpv --ytdl-format="bestvideo[height<=480]+bestaudio/best" \
#     --ytdl-raw-options=cookies=/home/yossef/.config/mpv/cookies.txt \
#     "$URL"

streamlink \
  --player mpv --player-no-close \
  --http-timeout 60 \
  --retry-open 5 \
  --retry-streams 5 \
  "$URL" best


